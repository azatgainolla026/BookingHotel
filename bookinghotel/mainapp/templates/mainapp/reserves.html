<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Мои бронирования</title>
  <link rel="stylesheet" href="{% static 'main.css' %}">
</head>
<body>
  <header>
    <div class="logo">Бронирование отелей</div>
    <nav>
      <a href="">Главная</a>
      <a href="/about/">О нас</a>
      <a href="/login/">Вход</a>
      <a href="/register/">Регистрация</a>
      <a href="/profile/">Профиль</a>
      <a href="/reserves/">Мои бронирования</a>
    </nav>
  </header>

  <section class="reserves" id="reserve-list">
    <h2>Мои бронирования</h2>
  </section>

  <script>
    const reserveList = document.getElementById("reserve-list");

    async function fetchReservations() {
      const res = await fetch('/api/user/reserves/');
      const data = await res.json();

      data.forEach(booking => {
        const card = document.createElement('div');
        card.className = 'reserve-card';
        card.innerHTML = `
          <h3>Отель: ${booking.room.hotel.name}</h3>
          <p>Комната: ${booking.room.room_type}</p>
          <p>Город: ${booking.room.hotel.city.name}</p>
          <p>Адрес: ${booking.room.hotel.address}</p>
          <p>Заселение: ${booking.check_in}</p>
          <p>Выезд: ${booking.check_out}</p>
          <p>Статус: <span class="status">${booking.status}</span></p>
          <button onclick="cancelReservation(${booking.id})" ${booking.status !== 'pending' ? 'disabled' : ''}>
            Отменить
          </button>
        `;
        reserveList.appendChild(card);
      });
    }

    async function cancelReservation(id) {
      const res = await fetch(`/api/user/reserves/${id}/cancel/`, {
        method: 'PATCH',
        headers: {
          'Content-Type': 'application/json',
        },
      });

      if (res.ok) {
        alert("Бронь отменена");
        reserveList.innerHTML = ''; // перезагрузить список
        fetchReservations();
      } else {
        alert("Ошибка при отмене брони");
      }
    }

    fetchReservations();
  </script>
</body>
</html>
